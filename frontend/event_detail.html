<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Detail Event</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="container">
  <a href="index.html" class="btn btn-link mt-3">&larr; Kembali</a>
  <div id="detail" class="mt-3"></div>
  <hr/>
  <h4>Daftar Peserta</h4>
  <div id="participants"></div>
  <hr/>
  <h4>Form Pendaftaran</h4>
  <form id="regForm" class="mb-5">
    <div class="mb-3"><input class="form-control" id="name" placeholder="Nama" required></div>
    <div class="mb-3"><input class="form-control" id="email" type="email" placeholder="Email" required></div>
    <button class="btn btn-success">Daftar</button>
  </form>

  <script>
  const api = "http://127.0.0.1:8000";
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  if(!id){
    document.getElementById('detail').innerHTML = '<div class="alert alert-danger">ID event tidak ditemukan pada URL.</div>';
  } else {
    async function loadDetail(){
      const evRes = await fetch(api + "/events");
      const events = await evRes.json();
      const ev = events.find(e=>e.id==id);
      if(!ev) { document.getElementById('detail').innerHTML = '<div class="alert alert-warning">Event tidak ditemukan.</div>'; return; }
      document.getElementById('detail').innerHTML = `<h2>${ev.title}</h2><p><b>${ev.date}</b> — ${ev.location}</p><p>${ev.description}</p><p><b>Kuota:</b> ${ev.quota}</p>`;
      const pRes = await fetch(api + `/events/${id}/participants`);
      const participants = await pRes.json();
      const pEl = document.getElementById('participants');
      pEl.innerHTML = '';
      participants.forEach(p=>{
        pEl.innerHTML += `<div class="card mb-2"><div class="card-body"><strong>${p.name}</strong> — ${p.email}</div></div>`;
      });
    }

    document.getElementById('regForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = { name: document.getElementById('name').value, email: document.getElementById('email').value, event_id: parseInt(id) };
      const res = await fetch(api + "/participants", { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(payload) });
      if(res.ok){ alert('Pendaftaran berhasil'); loadDetail(); document.getElementById('regForm').reset(); }
      else { const err = await res.json(); alert('Gagal: ' + (err.detail||JSON.stringify(err))); }
    });

    loadDetail();
  }
  </script>
</body>
</html>
